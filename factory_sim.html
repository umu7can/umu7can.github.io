<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karar Destek Sistemi - √úretim Hattƒ± Optimizasyon Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
        }
        .working {
            animation: pulse-glow 2s infinite;
        }
        @keyframes flow {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .product-flow {
            animation: flow 2s linear infinite;
        }
        .station-card {
            transition: all 0.3s ease;
        }
        .station-card:hover {
            transform: translateY(-5px);
        }
        @keyframes ai-pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        .ai-indicator {
            animation: ai-pulse 2s infinite;
        }
        .industrial-card {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        .metric-card {
            background: linear-gradient(145deg, #334155, #1e293b);
            border-left: 4px solid;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-950 via-slate-900 to-gray-950 min-h-screen text-white">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="mb-8 industrial-card rounded-xl p-6 shadow-2xl">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-cyan-400 via-blue-400 to-purple-500 bg-clip-text text-transparent">
                        Karar Destek Sistemi - √úretim Hattƒ± Optimizasyon
                    </h1>
                    <p class="text-slate-400">Theory of Constraints & Little's Law Sim√ºlasyonu - AI-Powered Analytics</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-slate-400">Sim√ºlasyon Zamanƒ±</div>
                    <div id="simTime" class="text-2xl font-bold text-cyan-400">0.0s</div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="industrial-card rounded-xl p-6 mb-8 shadow-2xl">
            <div class="flex flex-wrap gap-4 items-center justify-between">
                <div class="flex gap-4">
                    <button id="startBtn" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 px-6 py-2 rounded-lg font-semibold transition shadow-lg">
                        ‚ñ∂ Ba≈ülat
                    </button>
                    <button id="pauseBtn" class="bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 px-6 py-2 rounded-lg font-semibold transition shadow-lg" disabled>
                        ‚è∏ Duraklat
                    </button>
                    <button id="resetBtn" class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 px-6 py-2 rounded-lg font-semibold transition shadow-lg">
                        ‚Üª Sƒ±fƒ±rla
                    </button>
                </div>
                <div class="flex gap-4 items-center">
                    <label class="text-sm font-semibold text-slate-300">Sim√ºlasyon Hƒ±zƒ±:</label>
                    <input type="range" id="speedControl" min="1" max="10" value="5" class="w-32">
                    <span id="speedValue" class="text-sm font-bold text-cyan-400">5x</span>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Left: Analytics KPIs -->
            <div class="lg:col-span-2 space-y-4">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="metric-card rounded-lg p-4 shadow-xl border-cyan-500">
                        <div class="text-xs text-slate-400 mb-1 uppercase tracking-wide">Toplam √úretim</div>
                        <div id="totalProduced" class="text-3xl font-bold text-cyan-400">0</div>
                        <div class="text-xs text-slate-500 mt-1">birim</div>
                    </div>
                    <div class="metric-card rounded-lg p-4 shadow-xl border-purple-500">
                        <div class="text-xs text-slate-400 mb-1 uppercase tracking-wide">Cycle Time</div>
                        <div id="cycleTime" class="text-3xl font-bold text-purple-400">0</div>
                        <div class="text-xs text-slate-500 mt-1">saniye</div>
                    </div>
                    <div class="metric-card rounded-lg p-4 shadow-xl border-orange-500">
                        <div class="text-xs text-slate-400 mb-1 uppercase tracking-wide">Darboƒüaz</div>
                        <div id="bottleneck" class="text-2xl font-bold text-orange-400">-</div>
                        <div class="text-xs text-slate-500 mt-1">en yava≈ü</div>
                    </div>
                    <div class="metric-card rounded-lg p-4 shadow-xl border-green-500">
                        <div class="text-xs text-slate-400 mb-1 uppercase tracking-wide">Verimlilik</div>
                        <div id="efficiency" class="text-3xl font-bold text-green-400">0%</div>
                        <div class="text-xs text-slate-500 mt-1">teorik max</div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="metric-card rounded-lg p-4 shadow-xl border-blue-500">
                        <div class="text-xs text-slate-400 mb-1 uppercase tracking-wide">Ortalama Teslim S√ºresi</div>
                        <div id="avgDeliveryTime" class="text-2xl font-bold text-blue-400">0.0</div>
                        <div class="text-xs text-slate-500 mt-1">saniye</div>
                    </div>
                    <div class="metric-card rounded-lg p-4 shadow-xl border-pink-500">
                        <div class="text-xs text-slate-400 mb-1 uppercase tracking-wide">Toplam Arƒ±za Sayƒ±sƒ±</div>
                        <div id="totalFailures" class="text-2xl font-bold text-pink-400">0</div>
                        <div class="text-xs text-slate-500 mt-1">arƒ±za</div>
                    </div>
                </div>
            </div>

            <!-- Right: AI Insights -->
            <div class="lg:col-span-1">
                <div class="industrial-card rounded-xl p-6 shadow-2xl h-full">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="w-3 h-3 bg-cyan-400 rounded-full ai-indicator"></div>
                        <h3 class="text-lg font-bold text-cyan-400">AI Insights</h3>
                    </div>
                    <div id="aiInsights" class="space-y-3 text-sm">
                        <div class="text-slate-400 italic">Sim√ºlasyonu ba≈ülatƒ±n...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Production Line Visualization -->
        <div class="industrial-card rounded-xl p-8 mb-8 shadow-2xl">
            <h2 class="text-2xl font-bold mb-6 text-cyan-400">√úretim Hattƒ± - 5 A≈üamalƒ± Montaj</h2>
            <div class="space-y-4">
                <!-- Input Flow -->
                <div class="flex items-center justify-center mb-4">
                    <div class="bg-slate-700 rounded-lg px-6 py-3">
                        <div class="text-sm text-slate-400">Giri≈ü Akƒ±≈üƒ±</div>
                        <div id="inputRate" class="text-xl font-bold text-green-400">1 birim/sn</div>
                    </div>
                </div>

                <!-- Stations -->
                <div id="productionLine" class="space-y-6">
                    <!-- Stations will be generated here -->
                </div>

                <!-- Output -->
                <div class="flex items-center justify-center mt-4">
                    <div class="bg-slate-700 rounded-lg px-6 py-3">
                        <div class="text-sm text-slate-400">√áƒ±kƒ±≈ü</div>
                        <div id="outputRate" class="text-xl font-bold text-blue-400">0 birim/sn</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dynamic Scenario Analysis Panel -->
        <div class="industrial-card rounded-xl p-6 mb-8 shadow-2xl">
            <h2 class="text-2xl font-bold mb-6 text-cyan-400">Dinamik Senaryo Analizi</h2>
            <div id="stationSettings" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Settings will be generated here -->
            </div>
        </div>

        <!-- Simulation Results & Analytics -->
        <div class="industrial-card rounded-xl p-6 shadow-2xl">
            <h2 class="text-2xl font-bold mb-6 text-cyan-400">Sim√ºlasyon Sonu√ßlarƒ± & Veri Analizi</h2>

            <!-- Results Table -->
            <div class="mb-6 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-slate-700">
                            <th class="text-left py-3 px-4 text-slate-400 font-semibold">Metrik</th>
                            <th class="text-right py-3 px-4 text-slate-400 font-semibold">Deƒüer</th>
                            <th class="text-right py-3 px-4 text-slate-400 font-semibold">Trend</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTable">
                        <!-- Results will be populated here -->
                    </tbody>
                </table>
            </div>

            <!-- Performance Chart -->
            <div class="bg-slate-900 rounded-lg p-4">
                <h3 class="text-sm font-bold mb-4 text-slate-300">√úretim Performans Grafiƒüi (Son 60 saniye)</h3>
                <canvas id="performanceChart" width="800" height="200"></canvas>
            </div>
        </div>
    </div>

    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script>
        // Configuration
        const CONFIG = {
            stations: [
                { id: 1, name: 'Hammadde Hazƒ±rlama', processingTime: 3, bufferSize: 5, mtbf: 100, mttr: 5 },
                { id: 2, name: 'Montaj 1', processingTime: 5, bufferSize: 3, mtbf: 120, mttr: 8 },
                { id: 3, name: 'Montaj 2', processingTime: 4, bufferSize: 4, mtbf: 150, mttr: 6 },
                { id: 4, name: 'Kalite Kontrol', processingTime: 6, bufferSize: 3, mtbf: 200, mttr: 4 },
                { id: 5, name: 'Paketleme', processingTime: 2, bufferSize: 5, mtbf: 180, mttr: 3 }
            ],
            inputRate: 1 // 1 unit per second
        };

        // State
        let state = {
            running: false,
            time: 0,
            totalProduced: 0,
            stations: [],
            inputBuffer: [],
            speed: 5,
            totalFailures: 0,
            deliveryTimes: [],
            performanceHistory: [],
            aiInsightsUpdateCounter: 0
        };

        let intervals = {
            main: null,
            input: null,
            aiUpdate: null
        };

        // Initialize stations
        function initializeStations() {
            state.stations = CONFIG.stations.map(config => ({
                ...config,
                buffer: [],
                currentItem: null,
                processTimeRemaining: 0,
                status: 'idle', // idle, working, blocked, starved, failure
                totalProcessed: 0,
                blockedTime: 0,
                starvedTime: 0,
                workingTime: 0,
                failureTime: 0,
                timeSinceLastFailure: 0,
                isInFailure: false,
                failureRepairRemaining: 0,
                failureCount: 0
            }));
        }

        // Render production line
        function renderProductionLine() {
            const container = document.getElementById('productionLine');
            container.innerHTML = state.stations.map((station, index) => `
                <div class="station-card bg-slate-700 rounded-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex-1">
                            <h3 class="text-lg font-bold">${station.name}</h3>
                            <div class="text-sm text-slate-400">ƒ∞stasyon ${station.id}</div>
                        </div>
                        <div id="status-${station.id}" class="px-4 py-2 rounded-lg font-semibold text-sm">
                            Bo≈üta
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <div class="text-xs text-slate-400">ƒ∞≈ülem S√ºresi</div>
                            <div class="text-xl font-bold text-blue-400">${station.processingTime}s</div>
                        </div>
                        <div>
                            <div class="text-xs text-slate-400">Buffer</div>
                            <div class="text-xl font-bold" id="buffer-${station.id}">0/${station.bufferSize}</div>
                        </div>
                        <div>
                            <div class="text-xs text-slate-400">ƒ∞≈ülenen</div>
                            <div class="text-xl font-bold text-green-400" id="processed-${station.id}">0</div>
                        </div>
                    </div>

                    <div class="relative h-4 bg-slate-600 rounded-full overflow-hidden">
                        <div id="progress-${station.id}" class="h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all" style="width: 0%"></div>
                    </div>

                    <div class="mt-3 grid grid-cols-3 gap-2 text-xs">
                        <div>
                            <span class="text-slate-400">√áalƒ±≈üma:</span>
                            <span id="work-time-${station.id}" class="text-green-400 ml-1">0s</span>
                        </div>
                        <div>
                            <span class="text-slate-400">Blokaj:</span>
                            <span id="block-time-${station.id}" class="text-red-400 ml-1">0s</span>
                        </div>
                        <div>
                            <span class="text-slate-400">A√ßlƒ±k:</span>
                            <span id="starve-time-${station.id}" class="text-yellow-400 ml-1">0s</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Render station settings
        function renderStationSettings() {
            const container = document.getElementById('stationSettings');
            container.innerHTML = state.stations.map(station => `
                <div class="bg-slate-700 rounded-lg p-4 border border-slate-600">
                    <h4 class="font-bold mb-3 text-cyan-300">${station.name}</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="text-xs text-slate-400 block mb-1">Cycle Time (sn)</label>
                            <input type="number"
                                   id="time-${station.id}"
                                   value="${station.processingTime}"
                                   min="1"
                                   max="20"
                                   class="w-full bg-slate-800 border border-slate-600 rounded px-3 py-2 text-white"
                                   onchange="updateStationTime(${station.id}, this.value)">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 block mb-1">Buffer Boyutu</label>
                            <input type="number"
                                   id="buffer-size-${station.id}"
                                   value="${station.bufferSize}"
                                   min="1"
                                   max="10"
                                   class="w-full bg-slate-800 border border-slate-600 rounded px-3 py-2 text-white"
                                   onchange="updateBufferSize(${station.id}, this.value)">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 block mb-1">MTBF - Arƒ±zalar Arasƒ± (sn)</label>
                            <input type="number"
                                   id="mtbf-${station.id}"
                                   value="${station.mtbf}"
                                   min="10"
                                   max="500"
                                   class="w-full bg-slate-800 border border-slate-600 rounded px-3 py-2 text-white"
                                   onchange="updateMTBF(${station.id}, this.value)">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 block mb-1">MTTR - Onarƒ±m S√ºresi (sn)</label>
                            <input type="number"
                                   id="mttr-${station.id}"
                                   value="${station.mttr}"
                                   min="1"
                                   max="30"
                                   class="w-full bg-slate-800 border border-slate-600 rounded px-3 py-2 text-white"
                                   onchange="updateMTTR(${station.id}, this.value)">
                        </div>
                        <div class="pt-2 border-t border-slate-600 text-xs">
                            <div class="flex justify-between text-slate-400">
                                <span>Arƒ±za Sayƒ±sƒ±:</span>
                                <span id="failure-count-${station.id}" class="text-red-400">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Update station time
        window.updateStationTime = function(stationId, value) {
            const station = state.stations.find(s => s.id === stationId);
            if (station) {
                station.processingTime = parseInt(value);
                analyzeBottleneck();
            }
        };

        // Update buffer size
        window.updateBufferSize = function(stationId, value) {
            const station = state.stations.find(s => s.id === stationId);
            if (station) {
                station.bufferSize = parseInt(value);
            }
        };

        // Update MTBF
        window.updateMTBF = function(stationId, value) {
            const station = state.stations.find(s => s.id === stationId);
            if (station) {
                station.mtbf = parseInt(value);
            }
        };

        // Update MTTR
        window.updateMTTR = function(stationId, value) {
            const station = state.stations.find(s => s.id === stationId);
            if (station) {
                station.mttr = parseInt(value);
            }
        };

        // Simulation step
        function simulationStep() {
            state.time += 0.1;

            // Process each station
            state.stations.forEach((station, index) => {
                // Check for failures (MTBF/MTTR)
                if (!station.isInFailure) {
                    station.timeSinceLastFailure += 0.1;
                    // Check if failure should occur based on MTBF
                    if (station.timeSinceLastFailure >= station.mtbf && Math.random() < 0.01) {
                        station.isInFailure = true;
                        station.failureRepairRemaining = station.mttr;
                        station.failureCount++;
                        station.timeSinceLastFailure = 0;
                        state.totalFailures++;
                    }
                }

                // Handle failure state
                if (station.isInFailure) {
                    station.failureRepairRemaining -= 0.1;
                    station.failureTime += 0.1;
                    station.status = 'failure';

                    if (station.failureRepairRemaining <= 0) {
                        station.isInFailure = false;
                    }
                    return; // Skip processing during failure
                }

                // If station is currently processing
                if (station.currentItem !== null) {
                    station.processTimeRemaining -= 0.1;

                    if (station.processTimeRemaining <= 0) {
                        // Item finished processing
                        const nextStation = state.stations[index + 1];

                        if (nextStation) {
                            // Try to move to next station's buffer
                            if (nextStation.buffer.length < nextStation.bufferSize) {
                                nextStation.buffer.push(station.currentItem);
                                station.currentItem = null;
                                station.totalProcessed++;
                            } else {
                                // Next station's buffer is full - BLOCKED
                                station.status = 'blocked';
                                station.blockedTime += 0.1;
                            }
                        } else {
                            // Last station - output completed item
                            const deliveryTime = state.time - station.currentItem.entryTime;
                            state.deliveryTimes.push(deliveryTime);
                            state.totalProduced++;
                            station.currentItem = null;
                            station.totalProcessed++;
                        }
                    } else {
                        station.status = 'working';
                        station.workingTime += 0.1;
                    }
                }

                // Try to start processing next item
                if (station.currentItem === null && station.buffer.length > 0) {
                    station.currentItem = station.buffer.shift();
                    station.processTimeRemaining = station.processingTime;
                    station.status = 'working';
                    station.workingTime += 0.1;
                } else if (station.currentItem === null && station.buffer.length === 0) {
                    station.status = 'starved';
                    station.starvedTime += 0.1;
                }
            });

            // Track performance history
            if (Math.floor(state.time) !== Math.floor(state.time - 0.1)) {
                state.performanceHistory.push({
                    time: Math.floor(state.time),
                    produced: state.totalProduced
                });
                // Keep only last 60 seconds
                if (state.performanceHistory.length > 60) {
                    state.performanceHistory.shift();
                }
            }

            updateUI();
        }

        // Add input items (Little's Law)
        function addInputItem() {
            if (!state.running) return;

            const firstStation = state.stations[0];
            if (firstStation.buffer.length < firstStation.bufferSize) {
                firstStation.buffer.push({ id: Date.now(), entryTime: state.time });
            }
        }

        // Update UI
        function updateUI() {
            // Update simulation time
            document.getElementById('simTime').textContent = state.time.toFixed(1) + 's';

            // Update analytics
            document.getElementById('totalProduced').textContent = state.totalProduced;
            document.getElementById('cycleTime').textContent = calculateCycleTime().toFixed(1);
            document.getElementById('efficiency').textContent = calculateEfficiency().toFixed(1) + '%';
            document.getElementById('totalFailures').textContent = state.totalFailures;

            // Calculate and update average delivery time
            const avgDelivery = state.deliveryTimes.length > 0
                ? state.deliveryTimes.reduce((a, b) => a + b, 0) / state.deliveryTimes.length
                : 0;
            document.getElementById('avgDeliveryTime').textContent = avgDelivery.toFixed(1);

            // Update output rate
            const outputRate = state.time > 0 ? (state.totalProduced / state.time).toFixed(2) : '0.00';
            document.getElementById('outputRate').textContent = `${outputRate} birim/sn`;

            // Update each station
            state.stations.forEach(station => {
                // Status
                const statusEl = document.getElementById(`status-${station.id}`);
                let statusText = 'Bo≈üta';
                let statusClass = 'bg-slate-600 text-slate-300';

                if (station.status === 'working') {
                    statusText = '√áalƒ±≈üƒ±yor';
                    statusClass = 'bg-green-600 text-white working';
                } else if (station.status === 'blocked') {
                    statusText = 'Blokaj';
                    statusClass = 'bg-red-600 text-white';
                } else if (station.status === 'starved') {
                    statusText = 'A√ßlƒ±k';
                    statusClass = 'bg-yellow-600 text-white';
                } else if (station.status === 'failure') {
                    statusText = 'ARIZA';
                    statusClass = 'bg-pink-600 text-white animate-pulse';
                }

                statusEl.textContent = statusText;
                statusEl.className = `px-4 py-2 rounded-lg font-semibold text-sm ${statusClass}`;

                // Buffer
                const bufferFill = station.buffer.length;
                const bufferEl = document.getElementById(`buffer-${station.id}`);
                bufferEl.textContent = `${bufferFill}/${station.bufferSize}`;
                bufferEl.className = `text-xl font-bold ${
                    bufferFill === station.bufferSize ? 'text-red-400' :
                    bufferFill === 0 ? 'text-yellow-400' : 'text-green-400'
                }`;

                // Processed
                document.getElementById(`processed-${station.id}`).textContent = station.totalProcessed;

                // Progress bar
                const progress = station.currentItem !== null ?
                    ((station.processingTime - station.processTimeRemaining) / station.processingTime) * 100 : 0;
                document.getElementById(`progress-${station.id}`).style.width = `${progress}%`;

                // Times
                document.getElementById(`work-time-${station.id}`).textContent = station.workingTime.toFixed(1) + 's';
                document.getElementById(`block-time-${station.id}`).textContent = station.blockedTime.toFixed(1) + 's';
                document.getElementById(`starve-time-${station.id}`).textContent = station.starvedTime.toFixed(1) + 's';

                // Failure count
                const failureCountEl = document.getElementById(`failure-count-${station.id}`);
                if (failureCountEl) {
                    failureCountEl.textContent = station.failureCount;
                }
            });

            // Update results table
            updateResultsTable();

            // Update performance chart
            updatePerformanceChart();
        }

        // Calculate cycle time
        function calculateCycleTime() {
            // Sum of all processing times
            return state.stations.reduce((sum, s) => sum + s.processingTime, 0);
        }

        // Calculate efficiency
        function calculateEfficiency() {
            if (state.time === 0) return 0;

            // Bottleneck determines theoretical maximum throughput
            const bottleneck = Math.max(...state.stations.map(s => s.processingTime));
            const theoreticalMax = state.time / bottleneck;

            return (state.totalProduced / theoreticalMax) * 100;
        }

        // Analyze bottleneck (Theory of Constraints)
        function analyzeBottleneck() {
            const bottleneckStation = state.stations.reduce((max, station) =>
                station.processingTime > max.processingTime ? station : max
            );

            document.getElementById('bottleneck').textContent = bottleneckStation.name;
            return bottleneckStation;
        }

        // AI Insights - Analyze and provide recommendations
        function generateAIInsights() {
            const insights = [];

            // Identify bottleneck
            const bottleneck = state.stations.reduce((max, station) =>
                station.processingTime > max.processingTime ? station : max
            );

            // Calculate potential improvement
            const currentThroughput = state.time > 0 ? state.totalProduced / state.time : 0;
            const bottleneckImprovement = 0.1; // 10% improvement
            const newBottleneckTime = bottleneck.processingTime * (1 - bottleneckImprovement);
            const potentialThroughput = 1 / newBottleneckTime;
            const throughputIncrease = ((potentialThroughput - (1 / bottleneck.processingTime)) / (1 / bottleneck.processingTime)) * 100;

            insights.push({
                type: 'bottleneck',
                icon: 'üéØ',
                title: 'Darboƒüaz Analizi',
                text: `<strong>${bottleneck.name}</strong> darboƒüaz noktasƒ±. Kapasitesini %10 artƒ±rƒ±rsanƒ±z, toplam verim yakla≈üƒ±k <strong>%${throughputIncrease.toFixed(1)}</strong> artabilir.`,
                priority: 'high'
            });

            // Check for blocked stations
            const blockedStations = state.stations.filter(s => s.blockedTime > s.workingTime * 0.2);
            if (blockedStations.length > 0) {
                const mostBlocked = blockedStations.reduce((max, s) => s.blockedTime > max.blockedTime ? s : max);
                insights.push({
                    type: 'blocked',
                    icon: '‚ö†Ô∏è',
                    title: 'Blokaj Uyarƒ±sƒ±',
                    text: `<strong>${mostBlocked.name}</strong> sƒ±k sƒ±k bloke oluyor. Sonraki istasyonun buffer kapasitesini artƒ±rƒ±n veya hƒ±zƒ±nƒ± iyile≈ütirin.`,
                    priority: 'medium'
                });
            }

            // Check for starved stations
            const starvedStations = state.stations.filter(s => s.starvedTime > s.workingTime * 0.2);
            if (starvedStations.length > 0) {
                const mostStarved = starvedStations.reduce((max, s) => s.starvedTime > max.starvedTime ? s : max);
                insights.push({
                    type: 'starved',
                    icon: 'üìâ',
                    title: 'A√ßlƒ±k Problemi',
                    text: `<strong>${mostStarved.name}</strong> sƒ±k sƒ±k malzeme bekliyor. √ñnceki istasyonlarƒ±n hƒ±zƒ±nƒ± artƒ±rƒ±n veya buffer boyutunu b√ºy√ºt√ºn.`,
                    priority: 'medium'
                });
            }

            // Check for high failure stations
            const highFailureStations = state.stations.filter(s => s.failureCount > 2);
            if (highFailureStations.length > 0) {
                const mostFailing = highFailureStations.reduce((max, s) => s.failureCount > max.failureCount ? s : max);
                insights.push({
                    type: 'failure',
                    icon: 'üîß',
                    title: 'Bakƒ±m √ñnerisi',
                    text: `<strong>${mostFailing.name}</strong> √ßok arƒ±za veriyor (${mostFailing.failureCount} arƒ±za). MTBF deƒüerini artƒ±rarak bakƒ±m programƒ±nƒ± iyile≈ütirin.`,
                    priority: 'high'
                });
            }

            // Efficiency recommendation
            const efficiency = calculateEfficiency();
            if (efficiency < 70 && state.time > 30) {
                insights.push({
                    type: 'efficiency',
                    icon: 'üí°',
                    title: 'Verimlilik √ñnerisi',
                    text: `Sistem verimliliƒüi %${efficiency.toFixed(1)}. ƒ∞stasyonlar arasƒ± dengeyi optimize edin - t√ºm istasyonlarƒ±n cycle time deƒüerlerini darboƒüaza yakla≈ütƒ±rƒ±n.`,
                    priority: 'high'
                });
            }

            // Buffer optimization
            const overfilledBuffers = state.stations.filter(s => s.buffer.length === s.bufferSize);
            if (overfilledBuffers.length > 0) {
                insights.push({
                    type: 'buffer',
                    icon: 'üì¶',
                    title: 'Buffer Optimizasyonu',
                    text: `${overfilledBuffers.length} istasyonun buffer'ƒ± dolu. Bu istasyonlarƒ±n sonraki s√ºre√ßlerini hƒ±zlandƒ±rƒ±n.`,
                    priority: 'low'
                });
            }

            // Display insights
            const container = document.getElementById('aiInsights');
            if (insights.length === 0) {
                container.innerHTML = '<div class="text-slate-400 italic">Sistem dengeli √ßalƒ±≈üƒ±yor ‚úì</div>';
            } else {
                container.innerHTML = insights.map(insight => `
                    <div class="bg-slate-800 border-l-4 ${
                        insight.priority === 'high' ? 'border-red-500' :
                        insight.priority === 'medium' ? 'border-yellow-500' :
                        'border-blue-500'
                    } rounded p-3">
                        <div class="flex items-start gap-2">
                            <span class="text-xl">${insight.icon}</span>
                            <div class="flex-1">
                                <div class="font-semibold text-xs text-slate-300 mb-1">${insight.title}</div>
                                <div class="text-xs text-slate-400">${insight.text}</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Update results table
        function updateResultsTable() {
            const totalWorkTime = state.stations.reduce((sum, s) => sum + s.workingTime, 0);
            const totalBlockTime = state.stations.reduce((sum, s) => sum + s.blockedTime, 0);
            const totalStarveTime = state.stations.reduce((sum, s) => sum + s.starvedTime, 0);
            const totalFailureTime = state.stations.reduce((sum, s) => sum + s.failureTime, 0);

            const outputRate = state.time > 0 ? (state.totalProduced / state.time) : 0;

            const metrics = [
                { name: 'Toplam √úretilen √úr√ºn', value: state.totalProduced + ' birim', trend: 'üìà' },
                { name: 'Ortalama √áƒ±kƒ±≈ü Oranƒ±', value: outputRate.toFixed(3) + ' birim/sn', trend: outputRate > 0.15 ? '‚úÖ' : '‚ö†Ô∏è' },
                { name: 'Ortalama Teslim S√ºresi', value: (state.deliveryTimes.length > 0 ? (state.deliveryTimes.reduce((a,b) => a+b, 0) / state.deliveryTimes.length) : 0).toFixed(1) + ' sn', trend: 'üìä' },
                { name: 'Toplam √áalƒ±≈üma S√ºresi', value: totalWorkTime.toFixed(1) + ' sn', trend: '‚öôÔ∏è' },
                { name: 'Toplam Blokaj S√ºresi', value: totalBlockTime.toFixed(1) + ' sn', trend: totalBlockTime > 10 ? '‚ùå' : '‚úÖ' },
                { name: 'Toplam A√ßlƒ±k S√ºresi', value: totalStarveTime.toFixed(1) + ' sn', trend: totalStarveTime > 10 ? '‚ö†Ô∏è' : '‚úÖ' },
                { name: 'Toplam Arƒ±za S√ºresi', value: totalFailureTime.toFixed(1) + ' sn', trend: totalFailureTime > 10 ? 'üîß' : '‚úÖ' },
                { name: 'Sistem Verimliliƒüi', value: calculateEfficiency().toFixed(1) + '%', trend: calculateEfficiency() > 80 ? 'üåü' : 'üìâ' }
            ];

            const tbody = document.getElementById('resultsTable');
            tbody.innerHTML = metrics.map(m => `
                <tr class="border-b border-slate-800 hover:bg-slate-800 transition">
                    <td class="py-3 px-4 text-slate-300">${m.name}</td>
                    <td class="py-3 px-4 text-right font-bold text-cyan-400">${m.value}</td>
                    <td class="py-3 px-4 text-right text-xl">${m.trend}</td>
                </tr>
            `).join('');
        }

        // Update performance chart
        function updatePerformanceChart() {
            const canvas = document.getElementById('performanceChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // Clear canvas
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, width, height);

            if (state.performanceHistory.length < 2) return;

            // Calculate scale
            const maxProduced = Math.max(...state.performanceHistory.map(p => p.produced), 10);
            const xScale = width / 60; // 60 seconds
            const yScale = (height - 40) / maxProduced;

            // Draw grid
            ctx.strokeStyle = '#1e293b';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 6; i++) {
                const y = height - 20 - (i * (height - 40) / 6);
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();

                // Y-axis labels
                ctx.fillStyle = '#64748b';
                ctx.font = '10px monospace';
                ctx.fillText(Math.round(maxProduced * i / 6), 5, y - 5);
            }

            // Draw line chart
            ctx.strokeStyle = '#06b6d4';
            ctx.lineWidth = 2;
            ctx.beginPath();

            state.performanceHistory.forEach((point, index) => {
                const x = index * xScale;
                const y = height - 20 - (point.produced * yScale);

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });

            ctx.stroke();

            // Draw points
            ctx.fillStyle = '#06b6d4';
            state.performanceHistory.forEach((point, index) => {
                const x = index * xScale;
                const y = height - 20 - (point.produced * yScale);
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
            });

            // X-axis label
            ctx.fillStyle = '#64748b';
            ctx.font = '12px monospace';
            ctx.fillText('Zaman (saniye)', width - 100, height - 5);
            ctx.fillText('√úretim', 5, 15);
        }

        // Control functions
        function start() {
            state.running = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;

            // Main simulation loop
            const stepInterval = 100 / state.speed; // Adjusted for speed
            intervals.main = setInterval(simulationStep, stepInterval);

            // Input generator (1 unit per second)
            intervals.input = setInterval(addInputItem, 1000 / state.speed);

            // AI Insights update (every 3 seconds)
            intervals.aiUpdate = setInterval(generateAIInsights, 3000);
            generateAIInsights(); // Initial call
        }

        function pause() {
            state.running = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;

            clearInterval(intervals.main);
            clearInterval(intervals.input);
            clearInterval(intervals.aiUpdate);
        }

        function reset() {
            pause();
            state.time = 0;
            state.totalProduced = 0;
            state.totalFailures = 0;
            state.deliveryTimes = [];
            state.performanceHistory = [];
            initializeStations();
            renderProductionLine();
            renderStationSettings();
            analyzeBottleneck();
            updateUI();

            // Reset AI insights
            document.getElementById('aiInsights').innerHTML = '<div class="text-slate-400 italic">Sim√ºlasyonu ba≈ülatƒ±n...</div>';
        }

        // Speed control
        document.getElementById('speedControl').addEventListener('input', function(e) {
            state.speed = parseInt(e.target.value);
            document.getElementById('speedValue').textContent = state.speed + 'x';

            // Restart intervals if running
            if (state.running) {
                clearInterval(intervals.main);
                clearInterval(intervals.input);
                clearInterval(intervals.aiUpdate);

                const stepInterval = 100 / state.speed;
                intervals.main = setInterval(simulationStep, stepInterval);
                intervals.input = setInterval(addInputItem, 1000 / state.speed);
                intervals.aiUpdate = setInterval(generateAIInsights, 3000);
            }
        });

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', start);
        document.getElementById('pauseBtn').addEventListener('click', pause);
        document.getElementById('resetBtn').addEventListener('click', reset);

        // Initialize
        initializeStations();
        renderProductionLine();
        renderStationSettings();
        analyzeBottleneck();
        updateUI();
    </script>
</body>
</html>
